%%
%% This is file `hustvisual.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% hustvisual.dtx  (with options: `package')
%% hustvisual-vi.dtx  (with options: `package')
%% 
%%     Copyright (C) 2025 by HUANG Yuxi <hustvisual@hyxi.dev>
%% 
%%     This work may be distributed and/or modified under the
%%     conditions of the LaTeX Project Public License, either
%%     version 1.3c of this license or (at your option) any later
%%     version. This version of this license is in
%%        https://www.latex-project.org/lppl/lppl-1-3c.txt
%%     and the latest version of this license is in
%%        https://www.latex-project.org/lppl.txt
%%     and version 1.3c or later is part of all distributions of LaTeX
%%     version 2008 or later.
%% 
%%     This work has the LPPL maintenance status "maintained".
%% 
%%     The Current Maintainer of this work is HUANG Yuxi.
%% 
\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage{hustvisual}
  {2025-05-07}{1.0.0} %
  {Visual Identity of Huazhong University of Science and Technology}
\tl_const:Nn \c__hustvisual_univ_tl { vi }
\clist_const:Ne \c__hustvisual_depts_clist
  {
    \c__hustvisual_univ_tl,
  }
\int_const:Nn \c__hustvisual_nargs_int { 5 }
\clist_new:N \c__hustvisual_args_clist
\int_step_inline:nn { \c__hustvisual_nargs_int }
  {
    \exp_args:NNe \clist_put_right:Nn \c__hustvisual_args_clist
      {
        \int_to_roman:n { #1 }
      }
  }
\clist_map_inline:Nn \c__hustvisual_args_clist
  {
    \tl_new:c { l__hustvisual_color_arg_ #1 _tl }
    \tl_set:cn { l__hustvisual_color_arg_ #1 _tl } { black }
  }
\clist_new:N \l__hustvisual_color_args_clist
\tl_new:N \l__hustvisual_dept_tl
\clist_new:N \l__hustvisual_vi_clist
\int_new:N \l__hustvisual_ncolors_int
\prop_new:N \l__hustvisual_temps_prop
\tl_new:N \l__hustvisual_temp_tl
\tl_new:N \l__hustvisual_filename_tl
\clist_new:N \l__hustvisual_aliases_clist
\clist_new:N \l__hustvisual_colors_clist
\tl_new:N \l__hustvisual_vi_tl
\dim_new:N \l__hustvisual_width_dim
\dim_new:N \l__hustvisual_height_dim
\fp_new:N \l__hustvisual_opacity_fp
\prop_new:N \g__hustvisual_vi_prop
\cs_new:Npn \__hustvisual_msg_new:nn { \msg_new:nnn { hustvisual } }
\cs_new:Npn \__hustvisual_warning:n { \msg_warning:nn { hustvisual } }
\cs_new:Npn \__hustvisual_warning:ne { \msg_warning:nne { hustvisual } }
\cs_new:Npn \__hustvisual_warning:nee { \msg_warning:nnee { hustvisual } }
\cs_new:Npn \__hustvisual_warning:neee { \msg_warning:nneee { hustvisual } }
\cs_new:Npn \__hustvisual_error:n { \msg_error:nn { hustvisual } }
\cs_new:Npn \__hustvisual_error:ne { \msg_error:nne { hustvisual } }
\cs_new:Npn \__hustvisual_error:nee { \msg_error:nnee { hustvisual } }
\cs_new:Npn \__hustvisual_error:neee { \msg_error:nneee { hustvisual } }
\RequirePackage{tikz}
\RequirePackage{xcolor}
\__hustvisual_msg_new:nn { color-args-exceed }
{
  The~ `colors'~ arguments(#1)~ exceed~ the~ number~ of~ defined~ colors(#2).
  Please~ check~ the~ number~ of~ colors~ in~ the~ documentation~ of~ the~ package.
}
\int_new:N \l__hustvisual_color_nargs_int
\cs_new:Npn \__hustvisual_deploy_colors:
  {
    \int_set:Nn \l__hustvisual_color_nargs_int
      { \clist_count:N \l__hustvisual_color_args_clist }
    \int_compare:nNnTF
      { \l__hustvisual_color_nargs_int } > { \c__hustvisual_nargs_int }
      {
        \__hustvisual_warning:nee { color-args-exceed }
          { \int_use:N \l__hustvisual_color_nargs_int }
          { \int_use:N \c__hustvisual_nargs_int }
        \__hustvisual_deploy_colors:N \c__hustvisual_nargs_int
      }
      {
        \__hustvisual_deploy_colors:N \l__hustvisual_color_nargs_int
      }
  }
\tl_new:N \l__hustvisual_color_arg_tl
\cs_new:Npn \__hustvisual_deploy_colors:N #1
  {
    \int_step_inline:nn { #1 }
      {
        \tl_set:Nx \l__hustvisual_color_arg_tl
          {
            l__hustvisual_color_arg_
            \clist_item:Nn \c__hustvisual_args_clist { ##1 }
            _tl
          }
        \tl_set:cx
          {
            \l__hustvisual_color_arg_tl
          }
          {
            \clist_item:Nn \l__hustvisual_color_args_clist { ##1 }
          }
      }
  }
\cs_new:Npn \__hustvisual_sort_vi_name:
  {
    \__hustvisual_sort_vi_name:N \l__hustvisual_vi_clist
  }
\cs_new:Npn \__hustvisual_sort_vi_name:N #1
  {
    \clist_sort:Nn #1
      {
        \str_compare:nNnTF { ##1 } > { ##2 }
        { \sort_return_swapped: }
        { \sort_return_same: }
      }
  }
\tl_const:Nn \c__hustvisual_dept_sep_tl { - }
\tl_const:Nn \c__hustvisual_vi_sep_tl { - }
\cs_new:Npn \__hustvisual_vi_name:
  {
    \__hustvisual_vi_name:N \l__hustvisual_vi_clist
  }
\cs_new:Npn \__hustvisual_vi_name:N #1
  {
    \__hustvisual_vi_name:NN \l__hustvisual_dept_tl #1
  }
\cs_new:Npn \__hustvisual_vi_name:NN #1#2
  {
    \tl_use:N #1
    \tl_use:N \c__hustvisual_dept_sep_tl
    \exp_args:NNV \clist_use:Nn #2 \c__hustvisual_vi_sep_tl
  }
\tl_const:Nn \c__hustvisual_vi_filename_prefix_tl { hustvisual- }
\tl_const:Nn \c__hustvisual_vi_filename_suffix_tl { .def }
\cs_new:Npn \__hustvisual_vi_filename:
  {
    \tl_use:N \c__hustvisual_vi_filename_prefix_tl
    \__hustvisual_vi_name:
    \tl_use:N \c__hustvisual_vi_filename_suffix_tl
  }
\tl_new:N \l__hustvisual_prop_set_tl
\cs_new:Npn \__hustvisual_prop_default_value:N #1
  {
    \bool_set_false:N \l__hustvisual_prop_set_bool
    \prop_map_inline:Nn #1
      {
        \bool_if:NF \l__hustvisual_prop_set_bool
          {
            \bool_set_true:N \l__hustvisual_prop_set_bool
            \tl_set:Nn \l__hustvisual_prop_set_tl { ##2 }
          }
      }
    \tl_use:N \l__hustvisual_prop_set_tl
  }
\keys_define:nn { hustvisual }
  {
    dev .meta:nn = { hustvisual / dev } { #1 },
    user .meta:nn = { hustvisual / user } { #1 },
  }
\seq_new:N \l__hustvisual_color_models_seq
\seq_new:N \l__hustvisual_color_values_seq
\int_new:N \l__hustvisual_set_colors_int
\tl_new:N \l__hustvisual_color_model_tl
\tl_new:N \l__hustvisual_color_models_tl
\tl_new:N \l__hustvisual_color_values_tl
\clist_new:N \l__hustvisual_set_colors_clist
\cs_new:Npn \__hustvisual_set_color:nnn #1#2#3
  {
    \seq_set_split:Nnn \l__hustvisual_color_models_seq { / } { #2 }
    \seq_set_split:Nnn \l__hustvisual_color_values_seq { / } { #3 }
    \int_compare:nNnF
      { \seq_count:N \l__hustvisual_color_models_seq }
      =
      { \seq_count:N \l__hustvisual_color_values_seq }
      {
        \__hustvisual_error:nee { color-models-unpair }
          { \seq_count:N \l__hustvisual_color_models_seq }
          { \seq_count:N \l__hustvisual_color_values_seq }
      }
    \exp_args:NNe \int_set:Nn \l__hustvisual_set_colors_int
      { \seq_count:N \l__hustvisual_color_models_seq }
    \int_step_inline:nn { \l__hustvisual_set_colors_int } % ##1
      {
        \tl_set:Ne \l__hustvisual_color_model_tl
          { \seq_item:Nn \l__hustvisual_color_models_seq { ##1 } }
        \exp_args:Nne \str_if_eq:nnT { CMYK }
          { \seq_item:Nn \l__hustvisual_color_models_seq { ##1 } }
          {
            \clist_clear:N \l__hustvisual_set_colors_clist
            \seq_set_item:Nnn \l__hustvisual_color_models_seq { ##1 } { cmyk }
            \exp_args:Ne \clist_map_inline:nn % ####1
              { \seq_item:Nn \l__hustvisual_color_values_seq { ##1 } }
              {
                \clist_put_right:Ne \l__hustvisual_set_colors_clist
                  { \fp_to_decimal:n { \fp_eval:n { ####1 / 100 } } }
              }
            \exp_args:NNnV \seq_set_item:Nnn
              \l__hustvisual_color_values_seq { ##1 } \l__hustvisual_set_colors_clist
          }
      }
    \tl_set:Ne \l__hustvisual_color_models_tl
      { \seq_use:Nn \l__hustvisual_color_models_seq { / } }
    \tl_set:Ne \l__hustvisual_color_values_tl
      { \seq_use:Nn \l__hustvisual_color_values_seq { / } }
    \exp_args:Nnee \color_set:nnn { #1 }
      { \l__hustvisual_color_models_tl }
      { \l__hustvisual_color_values_tl }
    \definecolor { #1 }
      { \l__hustvisual_color_models_tl }
      { \l__hustvisual_color_values_tl }
  }
\__hustvisual_msg_new:nn { color-models-unpair }
  {
    The~ number(#1)~ of~ color~ models~ in~ the~ `colors'~
    arguments~ is~ not~ equal~ to~ the~ number(#2)~ of~ color values.
  }
\cs_new:Npn \__hustvisual_set_vi:n #1
  {
    \group_begin:
    \keys_set:nn { hustvisual / dev } { #1 }
    \__hustvisual_process_set_vi:
    \group_end:
  }
\keys_define:nn { hustvisual / dev }
  {
    dept .choices:Vn = \c__hustvisual_depts_clist
      {
        \tl_set_eq:NN \l__hustvisual_dept_tl \l_keys_choice_tl
      },
    dept .initial:V = \c__hustvisual_univ_tl,
    vi .clist_set:N = \l__hustvisual_vi_clist,
    vi .value_required:n = true,
    ncolors .int_set:N = \l__hustvisual_ncolors_int,
    ncolors .initial:V = \c_zero_int,
    temps .meta:nn = { hustvisual / dev / temps } { #1 },
    temps / unknown .code:n =
      {
        \clist_set:Nn \l__hustvisual_colors_clist { #1 }
        \prop_put:NVV \l__hustvisual_temps_prop \l_keys_key_str \l__hustvisual_colors_clist
      },
    filename .tl_set:N = \l__hustvisual_filename_tl,
    filename .initial:V = \c_empty_tl,
    aliases .clist_set:N = \l__hustvisual_aliases_clist,
    aliases .initial:V = \c_empty_clist,
  }
\prop_new:N \l__hustvisual_vi_prop
\int_new:N \l__hustvisual_ncolors_tmp_int
\clist_new:N \l__hustvisual_alias_name_clist
\tl_new:N \l__hustvisual_alias_name_tl
\cs_new:Npn \__hustvisual_process_set_vi:
  {
    \prop_clear:N \l__hustvisual_vi_prop
    \int_compare:nNnT
      { \l__hustvisual_ncolors_int } > { \c__hustvisual_nargs_int }
      {
        \__hustvisual_error:nee { colors-exceed-max }
          { \int_use:N \l__hustvisual_ncolors_int }
          { \int_use:N \c__hustvisual_nargs_int }
      }
    \prop_put:NnV \l__hustvisual_vi_prop { ncolors } \l__hustvisual_ncolors_int
    \prop_map_inline:Nn \l__hustvisual_temps_prop
      {
        \int_set:Nn \l__hustvisual_ncolors_tmp_int
          { \clist_count:n { ##2 } }
        \int_compare:nNnF
          { \l__hustvisual_ncolors_int } = { \l__hustvisual_ncolors_tmp_int }
          {
            \__hustvisual_error:neee { colors-not-match }
              { ##1 }
              { \int_use:N \l__hustvisual_ncolors_tmp_int }
              { \int_use:N \l__hustvisual_ncolors_int }
          }
      }
    \int_compare:nNnF
      { \l__hustvisual_ncolors_int } = { \c_zero_int }
      {
        \int_compare:nNnT
          { \prop_count:N \l__hustvisual_temps_prop } = { \c_zero_int }
          {
            \__hustvisual_error:n { no-temp }
          }
      }
    \prop_put:NnV \l__hustvisual_vi_prop { temps } \l__hustvisual_temps_prop
    \__hustvisual_sort_vi_name:
    \tl_if_empty:NT \l__hustvisual_filename_tl
      {
        \tl_set:Ne \l__hustvisual_filename_tl
          { \__hustvisual_vi_filename: }
      }
    \file_if_exist:VF \l__hustvisual_filename_tl
      {
        \__hustvisual_warning:nee { filename-error }
          { \tl_use:N \l__hustvisual_filename_tl }
          { \__hustvisual_vi_name: }
      }
    \prop_put:NnV \l__hustvisual_vi_prop { filename } \l__hustvisual_filename_tl
    \prop_if_in:NeT \g__hustvisual_vi_prop { \__hustvisual_vi_name: }
      {
        \__hustvisual_warning:ne { vi-skip }
          { \__hustvisual_vi_name: }
      }
    \prop_gput_if_not_in:NeV \g__hustvisual_vi_prop \__hustvisual_vi_name: \l__hustvisual_vi_prop
    \clist_map_variable:NNn \l__hustvisual_aliases_clist \l__hustvisual_alias_name_clist
      {
        \prop_clear:N \l__hustvisual_vi_prop
        \prop_put:Nne \l__hustvisual_vi_prop { source } { \__hustvisual_vi_name: }
        \tl_set:Ne \l__hustvisual_alias_name_tl
          { \__hustvisual_vi_name:N \l__hustvisual_alias_name_clist }
        \prop_if_in:NVT \g__hustvisual_vi_prop \l__hustvisual_alias_name_tl
          {
            \__hustvisual_warning:nee { vi-skip }
              { \l__hustvisual_alias_name_tl }
          }
        \prop_gput_if_not_in:NVV \g__hustvisual_vi_prop
          \l__hustvisual_alias_name_tl
          \l__hustvisual_vi_prop
      }
  }
\__hustvisual_msg_new:nn { colors-exceed-max }
  {
    The~ number(#1)~ of~ colors~ in~ the~ `ncolors'~ property~
    exceeds~ the~ maximum~ number(#2)~ of~ colors.~
    Please~ increase~ the~ number~ of~ colors~ in~ the~ \c__hustvisual_nargs_int.
  }
\__hustvisual_msg_new:nn { no-temp }
  {
    The~ `temps'~ property~ should~ be~ set~ to~ a~ list~ of~ colors,~
    when~ the~ `ncolors'~ property~ is~ not~ zero.
  }
\__hustvisual_msg_new:nn { colors-not-match }
  {
    The~ number(#2)~ of~ colors~ in~ the~ `temps'~ property(#1)~
    does~ not~ match~ the~ number(#3)~ asserted~ in~ the~
    `ncolors'~ property.
  }
\__hustvisual_msg_new:nn { filename-error }
  {
    The~ filename~(#1)~ of~ the~ vi(#2)~
    is~ not~ found~ in~ the~ TeX~ search~ path.~
    Please~ check~ the~ filename.
  }
\__hustvisual_msg_new:nn { vi-skip }
  {
    The~ vi~(#1)~ is~ already~ defined.~
    The~ new~ definition~ has~ been~ skipped.
  }
\NewDocumentCommand \hustvi { O{} m }
  {
    \group_begin:
    \keys_set:nn { hustvisual / user }
      {
        #1,
        vi = { #2 },
      }
    \__hustvisual_process_vi_name:
    \__hustvisual_process_temp:
    \__hustvisual_process_colors:
    \__hustvisual_process_file:
    \__hustvisual_process_vi:
    \group_end:
  }
\keys_define:nn { hustvisual / user }
  {
    dept .choices:Vn = \c__hustvisual_depts_clist
      {
        \tl_set_eq:NN \l__hustvisual_dept_tl \l_keys_choice_tl
      },
    vi .clist_set:N = \l__hustvisual_vi_clist,
    vi .value_required:n = true,
    filename .tl_set:N = \l__hustvisual_filename_tl,
    filename .initial:V = \c_empty_tl,
    width .dim_set:N = \l__hustvisual_width_dim,
    width .initial:V = \c_zero_dim,
    height .dim_set:N = \l__hustvisual_height_dim,
    height .initial:V = \c_zero_dim,
    temp .tl_set:N = \l__hustvisual_temp_tl,
    temp .initial:V = \c_empty_tl,
    colors .clist_set:N = \l__hustvisual_colors_clist,
    colors .initial:V = \c_empty_clist,
    opacity .fp_set:N = \l__hustvisual_opacity_fp,
    opacity .initial:V = \c_one_fp,
  }
\tl_new:N \l__hustvisual_source_name_tl
\cs_new:Npn \__hustvisual_process_vi_name:
  {
    \__hustvisual_sort_vi_name:
    \prop_get:NeNF \g__hustvisual_vi_prop \__hustvisual_vi_name: \l__hustvisual_vi_prop
      {
        \__hustvisual_error:nee { invalid-vi-name }
          { \l__hustvisual_dept_tl }
          { \l__hustvisual_vi_clist }
      }
    \prop_get:NnNT \l__hustvisual_vi_prop { source } \l__hustvisual_source_name_tl
      {
        \prop_get:NVN \g__hustvisual_vi_prop
          \l__hustvisual_source_name_tl
          \l__hustvisual_vi_prop
      }
  }
\__hustvisual_msg_new:nn { invalid-vi-name }
  {
    The~ combination~ of~ `dept'(#1)~ and~ `vi'(#2)~
    is~ not~ valid.~
    Please~ check~ the~ documentation~ of~ the~ package.
  }
\bool_new:N \l__hustvisual_prop_set_bool
\cs_new:Npn \__hustvisual_process_temp:
  {
    \prop_get:NnN \l__hustvisual_vi_prop { temps } \l__hustvisual_temps_prop
    \prop_get:NVNF \l__hustvisual_temps_prop
      \l__hustvisual_temp_tl \l__hustvisual_color_args_clist
      {
        \tl_if_empty:NF \l__hustvisual_temp_tl
          {
            \__hustvisual_warning:ne { invalid-temp }
              { \l__hustvisual_temp_tl }
          }
        \bool_set_false:N \l__hustvisual_prop_set_bool
        \prop_map_inline:Nn \l__hustvisual_temps_prop
          {
            \bool_if:NF \l__hustvisual_prop_set_bool
              {
                \bool_set_true:N \l__hustvisual_prop_set_bool
                \clist_set:Nn \l__hustvisual_color_args_clist { ##2 }
              }
          }
      }
    \__hustvisual_deploy_colors:
  }
\__hustvisual_msg_new:nn { invalid-temp }
  {
    The~ `temp'~ property~(#1)~ is~ not~ valid.~
    The~ default~ template~ will~ be~ used.~
    Please~ check~ the~ documentation~ of~ the~ package.
  }
\tl_new:N \l__hustvisual_color_tl
\cs_new:Npn \__hustvisual_process_colors:
  {
    \clist_if_empty:NF \l__hustvisual_colors_clist
      {
        \clist_set_eq:NN \l__hustvisual_color_args_clist \l__hustvisual_colors_clist
        \__hustvisual_deploy_colors:
      }
  }
\cs_new:Npn \__hustvisual_process_file:
  {
    \tl_if_empty:NT \l__hustvisual_filename_tl
      {
        \prop_get:NnN \l__hustvisual_vi_prop { filename } \l__hustvisual_filename_tl
      }
    \file_get:VnNF \l__hustvisual_filename_tl { \ExplSyntaxOn } \l__hustvisual_vi_tl
      {
        \__hustvisual_error:ne { file-not-found }
          { \tl_use:N \l__hustvisual_filename_tl }
      }
    \tl_gput_left:Nn \l__hustvisual_vi_tl
      {
        \begin{tikzpicture}[
          inner~sep=0pt,
          outer~sep=0pt,
          opacity=\fp_use:N \l__hustvisual_opacity_fp
        ]
      }
    \tl_gput_right:Nn \l__hustvisual_vi_tl
      {
        \end{tikzpicture}
        \color_fill:n {red}
      }
  }
\box_new:N \l__hustvisual_vi_box
\cs_new:Npn \__hustvisual_process_vi:
  {
    \exp_args:NNV \hbox_set:Nn \l__hustvisual_vi_box \l__hustvisual_vi_tl
    \dim_compare:nNnTF
      { \l__hustvisual_width_dim } > { \c_zero_dim }
      {
        \dim_compare:nNnTF
        { \l__hustvisual_height_dim } > { \c_zero_dim }
        {
          \exp_args:NNVV \box_resize_to_wd_and_ht:Nnn \l__hustvisual_vi_box
            \l__hustvisual_width_dim \l__hustvisual_height_dim
        }
        {
          \exp_args:NNV \box_resize_to_wd:Nn \l__hustvisual_vi_box \l__hustvisual_width_dim
        }
      }
      {
        \dim_compare:nNnT
        { \l__hustvisual_height_dim } > { \c_zero_dim }
        {
          \exp_args:NNV \box_resize_to_ht:Nn \l__hustvisual_vi_box \l__hustvisual_height_dim
        }
      }
    \box_use:N \l__hustvisual_vi_box
  }
\__hustvisual_msg_new:nn { file-not-found }
  {
    The~ file~(#1)~ is~ not~ found.~
    Please~ check~ the~ file~ name.
  }
\__hustvisual_set_color:nnn { hustblue } { CMYK } { 100, 74, 27, 0 }
\__hustvisual_set_color:nnn { hustred } { CMYK } { 10, 100, 100, 5 }
\__hustvisual_set_color:nnn { hustspacegray } { CMYK } { 0, 0, 0, 50 }
\__hustvisual_set_color:nnn { hustspacegrey } { CMYK } { 0, 0, 0, 50 }
\__hustvisual_set_color:nnn { hustoceanblue } { CMYK } { 100, 60, 0, 0 }
\__hustvisual_set_color:nnn { hustazureblue } { CMYK } { 80, 0, 0, 0 }
\__hustvisual_set_color:nnn { husttechgray } { CMYK } { 0, 0, 0, 50 }
\__hustvisual_set_color:nnn { husttechgrey } { CMYK } { 0, 0, 0, 50 }
\__hustvisual_set_color:nnn { hustantiquegold } { CMYK } { 19, 34, 56, 0 }
\__hustvisual_set_color:nnn { hustyouthgreen } { CMYK } { 40, 0, 100, 0 }
\__hustvisual_set_color:nnn { hustenergyred } { CMYK } { 0, 85, 85, 0 }
\__hustvisual_set_color:nnn { hustvitalityorange } { CMYK } { 0, 0, 60, 100 }
\__hustvisual_set_color:nnn { hustsunshineyellow } { CMYK } { 0, 20, 100, 0 }
\__hustvisual_set_color:nnn { hustbachelorgreen } { CMYK } { 52, 0, 43, 70 }
\__hustvisual_set_vi:n
  {
    vi = {emblem},
    ncolors = 3,
    temps = {
      default = { hustblue, hustred, hustspacegray },
      red = { hustred, hustred, hustred },
      black = { black, black, black },
      white = { white, white, white },
    },
  }
\__hustvisual_set_vi:n
  {
    vi = { horizontal, name, zh },
    aliases = {
      { name },
      { name, zh },
      { horizontal, name },
    },
    ncolors = 1,
    temps = {
      blue = { hustblue },
      red = { hustred },
      black = { black },
      white = { white },
      bachelorgreen = { hustbachelorgreen },
    },
  }
%% 
%%     This work consists of the files hustvisual.dtx
%%     and the derived files hustvisual.sty and hustvisual.ins.
%% 
%%
%% End of file `hustvisual.sty'.
