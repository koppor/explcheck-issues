%%
%% This is file `litetable.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% litetable.dtx  (with options: `package')
%% -----------------------------------------------------------------------
%%   Copyright (C) 2023-2025 by Mingyu Xia <myhsia@outlook.com>          *
%%                                                                       *
%%   This work may be distributed and/or modified under the conditions   *
%%   of the LaTeX Project Public License (LPPL), either version 1.3c of  *
%%   this license or (at your option) any later version.                 *
%%   The latest version of this license is in                            *
%%                                                                       *
%%       http://www.latex-project.org/lppl.txt                           *
%%                                                                       *
%%   and version 1.3c or later is part of all distributions of LaTeX     *
%%   version 2008 or later.                                              *
%%                                                                       *
%%   This work has the LPPL maintenance status `maintained'.             *
%%                                                                       *
%%   The Current Maintainer of this work is Mingyu Xia.                  *
%% -----------------------------------------------------------------------
\ProvidesExplPackage {litetable} {2025-11-15} {v3.8C}
  {A Colorful Timetable Design}
\RequirePackage{tikz}
\cs_new_protected:Npn \__ltbl_msg_new:nn #1#2
  { \msg_new:nnn { litetable } {#1} {#2} }
\cs_new_protected:Npn \__ltbl_msg_warning:n #1
  { \msg_warning:nn { litetable } {#1} }
\__ltbl_msg_new:nn { course }
  { \exp_not:N \course ~ box(s) ~ exceed ~ workdays ~ were ~ ignored }
\cs_new_protected_nopar:Npn \__ltbl_get_left:nN #1#2
  {
    \group_begin: \seq_set_split:Nnn \l__ltbl_tmpa_seq { -> } {#1}
    \exp_args:NNNe \group_end:
    \tl_set:Nn #2 { \seq_item:Nn \l__ltbl_tmpa_seq { 1 } }
  }
\cs_new_protected_nopar:Npn \__ltbl_get_right:nN #1#2
  {
    \group_begin: \seq_set_split:Nnn \l__ltbl_tmpa_seq { -> } {#1}
    \exp_args:NNNe \group_end:
    \tl_set:Nn #2 { \seq_item:Nn \l__ltbl_tmpa_seq { 2 } }
  }
\cs_generate_variant:Nn \__ltbl_get_left:nN  { eN }
\cs_generate_variant:Nn \__ltbl_get_right:nN { eN }
\NewDocumentCommand \weeklist { O{} m O{} }
  {
    \keys_set:nn { litetable / weeklist } { #1, #3 }
    \__ltbl_weeklist:n {#2}
  }
\keys_define:nn { litetable / weeklist }
  {
    format   .tl_set:N  = \l__ltbl_weeklist_format_tl,
      format .initial:n = \bfseries,
    sep      .tl_set:N  = \l__ltbl_weeklist_sep_tl
  }
\NewDocumentCommand \timelist { O{} m O{} }
  {
    \keys_set:nn { litetable / timelist } { #1, #3 }
    \__ltbl_timelist:n {#2}
  }
\keys_define:nn { litetable / timelist }
  {
    numformat    .tl_set:N   = \l__ltbl_timelist_numformat_tl,
      numformat  .initial:n  = \ttfamily \bfseries,
    timeformat   .tl_set:N   = \l__ltbl_timelist_timeformat_tl,
      timeformat .initial:n  = \ttfamily,
    hidetime     .bool_set:N = \l__ltbl_timelist_hidetime_bool,
      hidetime   .initial:n  = false,
      hidetime   .default:n  = true
  }
\dim_new:N \l__ltbl_textwidth_dim
\dim_new:N \l__ltbl_textheight_dim
\NewDocumentEnvironment { litetable } { O{} m O{} }
  {
    \clearpage \thispagestyle{empty}
    \group_begin:
    \dim_gset:Nn \l__ltbl_textwidth_dim
      { \fp_eval:n { \l__ltbl_scale_fp } \paperwidth }
    \dim_gset:Nn \l__ltbl_textheight_dim
      { \fp_eval:n { \l__ltbl_scale_fp } \paperheight }
    \keys_set:nn { litetable / frame } { #1, #3 }
    \tikzpicture [ remember~picture, overlay ]
      \__ltbl_maketable:n {#2}
  } { \endtikzpicture \group_end: \clearpage }
\keys_define:nn { litetable / frame }
  {
    scale   .fp_set:N  = \l__ltbl_scale_fp,
      scale .initial:n = 1.0,
    color   .tl_set:N  = \l__ltbl_bg_color_tl,
      color .initial:n = gray,
    hline   .tl_set:N  = \l__ltbl_hline_type_tl,
      hline .initial:n = solid,
    sem     .tl_set:N  = \l__ltbl_bg_sem_tl,
    unknown .code:n    = \tl_if_novalue:nF {#1}
      { \tl_set_eq:NN \l__ltbl_bg_color_tl \l_keys_key_tl }
  }
\NewDocumentCommand \course { O{} m O{} m O{} }
  {
    \group_begin:
    \bool_lazy_any:nTF
      {
        {
          \int_compare_p:nNn { \l__ltbl_weekday_int } >
            { \clist_count:N \l__ltbl_week_clist }
        }
        { \int_compare_p:nNn {#2} > { \clist_count:N \l__ltbl_time_clist } }
        { \int_compare_p:nNn {#4} > { \clist_count:N \l__ltbl_time_clist } }
      } { \__ltbl_msg_warning:n { course } }
      {
        \keys_set:nn { litetable / course } { #1, #3, #5 }
        \int_compare:nNnTF {#2} < {#4}
          { \__ltbl_course_box_aux:nn {#2} {#4} }
          { \__ltbl_course_box_aux:nn {#4} {#2} }
      }
    \group_end:
  }
\keys_define:nn { litetable / course }
  {
    color    .tl_set:N  = \l__ltbl_course_color_tl,
      color  .initial:n = black,
    subject  .tl_set:N  = \l__ltbl_course_subject_tl,
    lecture  .tl_set:N  = \l__ltbl_course_lecture_tl,
    location .tl_set:N  = \l__ltbl_course_location_tl,
    comment  .tl_set:N  = \l__ltbl_course_comment_tl,
    unknown  .code:n    = \tl_if_novalue:nF {#1}
      { \tl_set_eq:NN \l__ltbl_course_color_tl \l_keys_key_tl }
  }
\NewDocumentCommand \more { m }
  {
    \node [ yshift = .5\l__ltbl_time_vunit_dim, left = 1ex,
            darkgray, font = \small \bfseries
          ] at (current~page.south~east) {#1};
  }
\NewDocumentCommand \newday { O{1} } { \int_add:Nn \l__ltbl_weekday_int {#1} }
\int_new:N \l__ltbl_weekday_int
\int_set:Nn \l__ltbl_weekday_int { 1 }
\clist_new:N \l__ltbl_week_ratio_clist
\clist_new:N \l__ltbl_week_accum_clist
\fp_new:N \l__ltbl_week_num_fp
\dim_new:N \l__ltbl_week_hunit_dim
\cs_new_protected_nopar:Npn \__ltbl_weeklist:n #1
  {
    \clist_set:Nn \l__ltbl_week_clist {#1}
    \exp_args:NNf \clist_map_inline:Nn \l__ltbl_week_clist
      {
        \__ltbl_get_right:eN {##1} \l__ltbl_tmpb_tl
        \clist_put_right:Ne \l__ltbl_week_ratio_clist { \l__ltbl_tmpb_tl }
      }
    \int_step_inline:nn { \clist_count:N \l__ltbl_week_clist }
      {
        \clist_clear:N \l__ltbl_week_accumtmp_clist
        \int_step_inline:nn {##1}
          {
            \clist_put_right:Ne \l__ltbl_week_accumtmp_clist
              { \clist_item:Nn \l__ltbl_week_ratio_clist {####1} }
          }
        \clist_put_right:Ne \l__ltbl_week_accum_clist
          { \fp_eval:n { \clist_use:Nn \l__ltbl_week_accumtmp_clist { + } } }
      }
    \fp_set:Nn \l__ltbl_week_num_fp
      {
        \clist_item:Nn \l__ltbl_week_accum_clist
          { \clist_count:N \l__ltbl_week_clist }
      }
    \dim_set:Nn \l__ltbl_week_hunit_dim
      { \fp_eval:n { 14/\l__ltbl_week_num_fp/15 } \paperwidth }
  }
\int_new:N \l__ltbl_time_num_int
\dim_new:N \l__ltbl_time_vunit_dim
\cs_new_protected_nopar:Npn \__ltbl_timelist:n #1
  {
    \clist_set:Nn \l__ltbl_time_clist {#1}
    \int_set:Nn \l__ltbl_time_num_int { \clist_count:N \l__ltbl_time_clist }
    \dim_set:Nn \l__ltbl_time_vunit_dim
      { \fp_eval:n { 1/(2\l__ltbl_time_num_int + 3.5) } \paperheight }
  }
\dim_new:N \l__ltbl_timelist_shift_dim
\cs_new_protected_nopar:Npn \__ltbl_maketable:n #1
  {
    \fill [ \l__ltbl_bg_color_tl!5 ]
      (current~page.north~west) rectangle +
      (\paperwidth, -1.5\l__ltbl_time_vunit_dim)
     node [ midway, black, font = \huge \bfseries ] {#1};
    \tl_if_empty:NF \l__ltbl_bg_sem_tl
      {
        \node [ shift = {(-.02\paperwidth, -.75\l__ltbl_time_vunit_dim)},
                left, rectangle, fill = DarkBlue!10, text = DarkBlue!60,
                inner~sep = 2ex, rounded~corners = 8pt, font = \large
              ] at (current~page.north~east) { \l__ltbl_bg_sem_tl };
      }
    \int_step_inline:nnnn { 0 } { 2 } { \l__ltbl_time_num_int }
      {
        \filldraw [ fill = \l__ltbl_bg_color_tl!5, thick,
                    draw = gray, \l__ltbl_hline_type_tl ]
          ([shift =
            {(-.4pt, \fp_eval:n { -2 * ##1 - 2.5 } \l__ltbl_time_vunit_dim)}
           ]current~page.north~west
          ) rectangle + (\paperwidth + .8pt, -2\l__ltbl_time_vunit_dim);
      }
    \bool_if:NTF \l__ltbl_timelist_hidetime_bool
      {
        \dim_set:Nn \l__ltbl_timelist_shift_dim
          { -1.5\l__ltbl_time_vunit_dim }
      }
      {
        \dim_set:Nn \l__ltbl_timelist_shift_dim
          { -\l__ltbl_time_vunit_dim }
      }
    \int_step_inline:nn { \l__ltbl_time_num_int }
      {
        \node [ darkgray!80, shift =
                {(
                  \paperwidth/30,
                  -2 * ##1 \l__ltbl_time_vunit_dim +
                  \l__ltbl_timelist_shift_dim
                )}, font = \large \l__ltbl_timelist_numformat_tl
              ] at (current~page.north~west) {##1};
      }
    \bool_if:NF \l__ltbl_timelist_hidetime_bool
      {
        \int_step_inline:nn { \clist_count:N \l__ltbl_time_clist }
          {
            \__ltbl_get_left:eN  { \clist_item:Nn \l__ltbl_time_clist {##1} }
              \l__ltbl_tmpa_tl
            \__ltbl_get_right:eN { \clist_item:Nn \l__ltbl_time_clist {##1} }
              \l__ltbl_tmpb_tl
            \node [ gray, align = center, shift =
                    {(
                      \paperwidth/30,
                      \fp_eval:n { -1.85 - 2 * ##1 } \l__ltbl_time_vunit_dim
                    )}, font = \l__ltbl_timelist_timeformat_tl
                  ] at (current~page.north~west)
              { \l__ltbl_tmpa_tl\\ \l__ltbl_tmpb_tl };
          }
      }
    \int_step_inline:nn { \clist_count:N \l__ltbl_week_clist }
      {
        \int_compare:nNnF {##1} = { \clist_count:N \l__ltbl_week_clist }
          {
            \node [ shift =
                    {(\fp_eval:n
                        {
                          14 * \clist_item:Nn \l__ltbl_week_accum_clist {##1}/
                          \l__ltbl_week_num_fp/15 + 1/15
                        } \paperwidth, -2\l__ltbl_time_vunit_dim
                    )}, darkgray, font = \ttfamily
                  ] at (current~page.north~west) { \l__ltbl_weeklist_sep_tl };
          }
        \__ltbl_get_left:eN { \clist_item:Nn \l__ltbl_week_clist {##1} }
          \l__ltbl_tmpa_tl
        \node [ shift =
                {(\fp_eval:n
                    {
                      14(
                        \clist_item:Nn \l__ltbl_week_accum_clist {##1} -
                        \clist_item:Nn \l__ltbl_week_ratio_clist {##1}/2
                        )/\l__ltbl_week_num_fp/15 + 1/15
                    } \paperwidth, -2\l__ltbl_time_vunit_dim
                )}, font = \large \l__ltbl_weeklist_format_tl
              ] at (current~page.north~west) { \l__ltbl_tmpa_tl };
      }
  }
\dim_new:N \l__ltbl_course_shift_dim
\cs_new_protected_nopar:Npn \__ltbl_course_box_aux:nn #1#2
  {
    \begin{scope}
      \clip [ preaction = { draw, ultra~thick, \l__ltbl_course_color_tl!60 },
              preaction = { fill, \l__ltbl_course_color_tl!10 },
              rounded~corners = 8pt ]
        ([shift =
          {(
            \fp_eval:n
              {
                \clist_item:Nn \l__ltbl_week_accum_clist
                  { \l__ltbl_weekday_int } -
                \clist_item:Nn \l__ltbl_week_ratio_clist
                  { \l__ltbl_weekday_int }
              } \l__ltbl_week_hunit_dim + \paperwidth/15 + 1.2pt,
            \fp_eval:n { -.5 - 2 * #1 } \l__ltbl_time_vunit_dim - 1.2pt
        )}]current~page.north~west) rectangle +
        (
          \clist_item:Nn \l__ltbl_week_ratio_clist
            { \l__ltbl_weekday_int } \l__ltbl_week_hunit_dim - 2.4pt,
          \fp_eval:n { 2(#1 - #2 - 1) } \l__ltbl_time_vunit_dim + 2.4pt
        );
      \fill [ \l__ltbl_course_color_tl!60 ]
        ([shift =
          {(
            \fp_eval:n
              {
                \clist_item:Nn \l__ltbl_week_accum_clist
                  { \l__ltbl_weekday_int } -
                \clist_item:Nn \l__ltbl_week_ratio_clist
                  { \l__ltbl_weekday_int }
              } \l__ltbl_week_hunit_dim + \paperwidth/15,
            \fp_eval:n { -.5 - 2 * #1 } \l__ltbl_time_vunit_dim
        )}]current~page.north~west) rectangle +
        (
          \clist_item:Nn \l__ltbl_week_ratio_clist
            { \l__ltbl_weekday_int } \l__ltbl_week_hunit_dim,
          -\l__ltbl_time_vunit_dim/2
        );
    \end{scope}
    \int_compare:nNnTF {#1} = {#2}
      {
        \bool_lazy_and:nnTF
          { \tl_if_empty_p:N \l__ltbl_course_location_tl   }
          { \tl_if_empty_p:N \l__ltbl_course_lecture_tl    }
          { \tl_set:Nn \l__ltbl_course_anchor_tl {       } }
          { \tl_set:Nn \l__ltbl_course_anchor_tl { above } }
        \node
          [ \l__ltbl_course_anchor_tl, \l__ltbl_course_color_tl!60, shift =
            {(
              \fp_eval:n
                {
                  \clist_item:Nn \l__ltbl_week_accum_clist
                    { \l__ltbl_weekday_int } -
                  \clist_item:Nn \l__ltbl_week_ratio_clist
                    { \l__ltbl_weekday_int }/2
                } \l__ltbl_week_hunit_dim + \paperwidth/15,
              \fp_eval:n { -1.75 - #1 - #2 } \l__ltbl_time_vunit_dim
            )}, align = center, font = \bfseries
          ] at (current~page.north~west) { \l__ltbl_course_subject_tl };
        \bool_lazy_or:nnTF
          { \tl_if_empty_p:N \l__ltbl_course_location_tl }
          { \tl_if_empty_p:N \l__ltbl_course_lecture_tl  }
          { \tl_set:Nn \l__ltbl_s@course_sep_tl {    }   }
          { \tl_set:Nn \l__ltbl_s@course_sep_tl { ,~ }   }
        \node
          [ shift =
            {(
              \fp_eval:n
                {
                  \clist_item:Nn \l__ltbl_week_accum_clist
                    { \l__ltbl_weekday_int } -
                  \clist_item:Nn \l__ltbl_week_ratio_clist
                    { \l__ltbl_weekday_int }/2
                } \l__ltbl_week_hunit_dim + \paperwidth/15,
              \fp_eval:n { -1.75 - #1 - #2 } \l__ltbl_time_vunit_dim
            )}, below, \l__ltbl_course_color_tl!60, align = center
          ] at (current~page.north~west)
          {
            \l__ltbl_course_location_tl
            \l__ltbl_s@course_sep_tl
            \l__ltbl_course_lecture_tl
          };
      }
      {
        \bool_lazy_and:nnTF
          { \tl_if_empty_p:N \l__ltbl_course_location_tl }
          { \tl_if_empty_p:N \l__ltbl_course_lecture_tl }
          {
            \tl_set:Nn \l__ltbl_course_anchor_tl { }
            \dim_set:Nn \l__ltbl_course_shift_dim { 0pt }
          }
          {
            \tl_set:Nn \l__ltbl_course_anchor_tl { above }
            \dim_set:Nn \l__ltbl_course_shift_dim { \l__ltbl_time_vunit_dim/8 }
          }
        \node
          [ \l__ltbl_course_color_tl!60, align = center, shift =
            {(
              \fp_eval:n
                {
                  \clist_item:Nn \l__ltbl_week_accum_clist
                    { \l__ltbl_weekday_int } -
                  \clist_item:Nn \l__ltbl_week_ratio_clist
                    { \l__ltbl_weekday_int }/2
                } \l__ltbl_week_hunit_dim + \paperwidth/15,
              \fp_eval:n { -1.5 - #1 - #2 } \l__ltbl_time_vunit_dim +
              \l__ltbl_course_shift_dim
            )}, font = \large \bfseries, \l__ltbl_course_anchor_tl
          ] at (current~page.north~west) { \l__ltbl_course_subject_tl };
        \bool_lazy_or:nnTF
          { \tl_if_empty_p:N \l__ltbl_course_location_tl }
          { \tl_if_empty_p:N \l__ltbl_course_lecture_tl  }
          { \tl_set:Nn \l__ltbl_course_sep_tl {    }     }
          { \tl_set:Nn \l__ltbl_course_sep_tl { \\ }     }
        \node
          [ shift =
            {(
              \fp_eval:n
                {
                  \clist_item:Nn \l__ltbl_week_accum_clist
                    { \l__ltbl_weekday_int } -
                  \clist_item:Nn \l__ltbl_week_ratio_clist
                    { \l__ltbl_weekday_int }/2
                } \l__ltbl_week_hunit_dim + \paperwidth/15,
              \fp_eval:n { -1.625 - #1 - #2 } \l__ltbl_time_vunit_dim
            )}, below, \l__ltbl_course_color_tl!60, align = center
          ] at (current~page.north~west)
          {
            \l__ltbl_course_location_tl
            \l__ltbl_course_sep_tl
            \l__ltbl_course_lecture_tl
          };
        \node
          [ shift =
            {(
              \clist_item:Nn \l__ltbl_week_accum_clist
                { \l__ltbl_weekday_int } \l__ltbl_week_hunit_dim +
              \paperwidth/15,
              \fp_eval:n { -2.5 - 2 * #2 } \l__ltbl_time_vunit_dim
            )}, above~left, \l__ltbl_course_color_tl!60, outer~sep = .5ex
          ] at (current~page.north~west) { \l__ltbl_course_comment_tl };
      }
  }
\file_input_stop:
%% -----------------------------------------------------------------------
%%   This work consists of the files litetable.dtx,                      *
%%                                   litetable.ins,                      *
%%                 the derived files litetable.sty,                      *
%%           the documentation files litetable.pdf,                      *
%%                               and README.md.                          *
%% -----------------------------------------------------------------------
%%
%% End of file `litetable.sty'.
