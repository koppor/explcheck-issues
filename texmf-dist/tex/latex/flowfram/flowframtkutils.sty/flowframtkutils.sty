%%
%% This is file `flowframtkutils.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% flowfram.dtx  (with options: `flowframtkutils.sty,package')
%% 
%%  flowfram.dtx
%%  Copyright 2025 Nicola Talbot
%% 
%%  This work may be distributed and/or modified under the
%%  conditions of the LaTeX Project Public License, either version 1.3
%%  of this license or (at your option) any later version.
%%  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%%  and version 1.3 or later is part of all distributions of LaTeX
%%  version 2005/12/01 or later.
%% 
%%  This work has the LPPL maintenance status `maintained'.
%% 
%%  The Current Maintainer of this work is Nicola Talbot.
%% 
%%  This work consists of the files flowfram.dtx and flowfram.ins and the derived files flowfram.sty, flowframtkutils.sty, flowfram-2014-09-30.sty, flowfram-2025-08-23.sty, flowfram.l2h.
%% 
%% \CharacterTable
%%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%%   Digits        \0\1\2\3\4\5\6\7\8\9
%%   Exclamation   \!     Double quote  \"     Hash (number) \#
%%   Dollar        \$     Percent       \%     Ampersand     \&
%%   Acute accent  \'     Left paren    \(     Right paren   \)
%%   Asterisk      \*     Plus          \+     Comma         \,
%%   Minus         \-     Point         \.     Solidus       \/
%%   Colon         \:     Semicolon     \;     Less than     \<
%%   Equals        \=     Greater than  \>     Question mark \?
%%   Commercial at \@     Left bracket  \[     Backslash     \\
%%   Right bracket \]     Circumflex    \^     Underscore    \_
%%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%%   Right brace   \}     Tilde         \~}
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{flowframtkutils}[2025/11/24 v2.0 (NLCT)]
\ExplSyntaxOn
\bool_new:N \l__flowframtk_outline_bool
\bool_set_false:N \l__flowframtk_outline_bool
\bool_new:N \l__flowframtk_textpath_bool
\bool_set_false:N \l__flowframtk_textpath_bool
\keys_define:nn { flowframtkutils }
{
   outline .bool_set:N = \l__flowframtk_outline_bool ,
   outline .usage:n = { load },
   textpath .bool_set:N = \l__flowframtk_textpath_bool ,
   textpath .usage:n = { load },
}
\ExplSyntaxOff
\ProcessKeyOptions[flowframtkutils]
\RequirePackage{pgf}
\RequirePackage{graphicx}
\ExplSyntaxOn
\clist_new:N \g__flowframtk_options_clist
\IfPackageLoadedTF { flowfram }
  {
   \newcommand \FlowFramTkSetKey [ 1 ]
    {
      \keys_set:nn { flowfram } { #1 }
    }
  }
  {
   \newcommand \FlowFramTkSetKey [ 1 ]
    {
      \clist_gput_right:Nn \g__flowframtk_options_clist { #1 }
    }
  }
\newcommand \FlowFramTkDeclareKeys [ 1 ]
 {
  \keys_define:nn { #1 }
   {
     adjust-toc .code:n =
       {
          \FlowFramTkSetKey { adjust-toc = { ##1 } }
       } ,
     backmatter-sections .code:n =
       {
          \FlowFramTkSetKey { backmatter-sections = { ##1 } }
       } ,
     color .code:n =
       {
         \FlowFramTkSetKey { color = { ##1 } }
       } ,
     color .default:n = { true } ,
     column-changes .code:n =
       {
          \FlowFramTkSetKey { column-changes = { ##1 } }
       } ,
     draft .code:n =
      {
         \FlowFramTkSetKey { draft }
      } ,
     dynamic-empty-page-style .code:n =
       {
          \FlowFramTkSetKey { dynamic-empty-page-style = { ##1 } }
       } ,
     dynamic-header-case .code:n =
       {
          \FlowFramTkSetKey { dynamic-header-case = { ##1 } }
       } ,
     dynamic-page-style .code:n =
       {
          \FlowFramTkSetKey { dynamic-page-style = { ##1 } }
       } ,
     dynamic-page-style-header-font .code:n =
       {
          \FlowFramTkSetKey { dynamic-page-style-header-font = { ##1 } }
       } ,
     dynamic-page-style-subheader-font .code:n =
       {
          \FlowFramTkSetKey { dynamic-page-style-subheader-font = { ##1 } }
       } ,
     dynamic-subheader-case .code:n =
       {
          \FlowFramTkSetKey { dynamic-subheader-case = { ##1 } }
       } ,
     final .code:n =
      {
         \FlowFramTkSetKey { final }
      } ,
     LR .code:n =
      {
         \FlowFramTkSetKey { LR = ##1 }
      } ,
     LR .default:n = { true } ,
     matter-thumbtabs .code:n =
      {
         \FlowFramTkSetKey { matter-thumbtabs = { ##1 } }
      } ,
     nocolor .code:n =
      {
         \FlowFramTkSetKey { nocolor }
      } ,
     norotate .code:n =
      {
         \FlowFramTkSetKey { norotate }
      } ,
     pages .code:n =
      {
         \FlowFramTkSetKey { pages = ##1 }
      } ,
     prohibit-frame-rotation .code:n =
      {
         \FlowFramTkSetKey { prohibit-frame-rotation = { ##1 } }
      } ,
     prohibit-frame-rotation .default:n = { true } ,
     RL .code:n =
      {
         \FlowFramTkSetKey { RL = ##1 }
      } ,
     RL .default:n = { true } ,
     rotate .code:n =
      {
         \FlowFramTkSetKey { rotate = { ##1 } }
      } ,
     rotate .default:n = { true } ,
     thumbtabs .code:n =
      {
         \FlowFramTkSetKey { thumbtabs = ##1 }
      } ,
     thumbtabs .default:n = { title } ,
     thumbtab-links .code:n =
      {
         \FlowFramTkSetKey { thumbtab-links = { ##1 } }
      } ,
     thumbtab-text .code:n =
      {
         \FlowFramTkSetKey { thumbtab-text = { ##1 } }
      } ,
     toc-thumbtabs .code:n =
      {
         \FlowFramTkSetKey { toc-thumbtabs = { ##1 } }
      } ,
     toc-thumbtabs .default:n = { true } ,
     ttbnotitle .code:n =
      {
         \FlowFramTkSetKey { ttbnotitle }
      } ,
     ttbnonum .code:n =
      {
         \FlowFramTkSetKey { ttbnonum }
      } ,
     ttbnum .code:n =
      {
         \FlowFramTkSetKey { ttbnum }
      } ,
     ttbtitle .code:n =
      {
         \FlowFramTkSetKey { ttbtitle }
      } ,
     sections-extra-option .code:n =
       {
          \FlowFramTkSetKey { sections-extra-option = { ##1 } }
       } ,
     verbose .code:n =
      {
         \FlowFramTkSetKey { verbose = { ##1 } }
      } ,
     verbose .default:n = { true } ,
     unstarred-thumbtabs .code:n =
      {
         \FlowFramTkSetKey { unstarred-thumbtabs = { ##1 } }
      } ,
     unstarred-thumbtabs .default:n = { true } ,
   }
 }
\NewDocumentCommand \jdrimagebox { m }
 {
   \noindent
   \vbox_to_ht:nn { \textheight } { \hbox_to_wd:nn { \textwidth } { #1 } }
 }
\newcommand \@flowframtk@def@outlinelua
 {
   \RequirePackage{luatex85}
   \@flowframtk@def@outlinepdf
 }
\newcommand \@flowframtk@def@outlinepdf
 {
   \cs_set_eq:NN \__flowframtk_mod: \mod
   \input{pdf-trans}
   \let \flowframtkpdftransmod \mod
   \cs_set_eq:NN \mod \__flowframtk_mod:
   \NewDocumentCommand \jdroutline { m m m }
    {
     \setbox\@tempboxa\hbox{##3}
     \boxgs{##1}{}\copy\@tempboxa
    }
 }
\newcommand \@flowframtk@def@outlinepst
 {
   \RequirePackage{pst-char}
   \NewDocumentCommand \jdroutline { m m m }
    {
     \begin{pspicture}(0,0)
     \pscharpath[##2]{##3}
     \end{pspicture}
   }
 }
\msg_new:nnn { flowframtk }
 { no-outline }
 {
   outline ~ support ~ not ~ enabled
 }
\newcommand \@flowframtk@outline
 {
   \NewDocumentCommand \jdroutline { m m m }
    {
      \msg_warning:nn { flowframtk } { no-outline }
      ##3
    }
 }
\bool_if:NT \l__flowframtk_outline_bool
 {
   \sys_if_engine_luatex:TF
    {
      \let \@flowframtk@outline \@flowframtk@def@outlinelua
    }
    {
      \sys_if_engine_pdftex:TF
       {
         \let \@flowframtk@outline \@flowframtk@def@outlinepdf
       }
       {
         \let \@flowframtk@outline \@flowframtk@def@outlinepst
       }
    }
 }
\bool_if:NTF \l__flowframtk_textpath_bool
 {
   \newcommand \@flowframtk@provide@textpath
    {
      \usepgflibrary{decorations.text}
    }
 }
 {
   \newcommand \@flowframtk@provide@textpath { }
 }
\ExplSyntaxOff
\@flowframtk@outline
\@flowframtk@provide@textpath
\ExplSyntaxOn
\tl_new:N \l__flowframtk_tmp_tl
\newcommand\flowframtkencapobject[8]{#8}
\newcommand\flowframtkstartobject[7]{}
\newcommand\flowframtkendobject[7]{}
\cs_new:Nn \flowframtkutils_uncover:nn
 {
   \uncover < #1 > { #2 }
 }
\cs_new:Nn \flowframtkutils_uncover_from:nn
 {
   \uncover < #1 - > { #2 }
 }
\cs_new:Nn \__flowframtkutils_uncover:nn
 {
   \flowframtkutils_uncover_from:nn { #1 } { #2 }
 }
\cs_new:Nn \__flowframtkutils_current_encap:nn { #2 }
\int_new:N \g_flowframtkutils_overlay_int
\tl_new:N \l__flowframtkutils_overlay_tl
\bool_new:N \l__flowframtkutils_auto_overlay_bool
\bool_set_true:N \l__flowframtkutils_auto_overlay_bool
\tl_new:N \l__flowframtkutils_propval_tl
\prop_new:N \l_flowframtkutils_tag_text_prop
\prop_new:N \l_flowframtkutils_tag_overlay_prop
\prop_new:N \l_flowframtkutils_object_type_overlay_prop
\bool_new:N \l_flowframtkutils_annote_bool
\bool_set_false:N \l_flowframtkutils_annote_bool
\bool_new:N \l_flowframtkutils_annote_arrow_bool
\bool_set_true:N \l_flowframtkutils_annote_arrow_bool
\dim_new:N \l_flowframtkutils_annote_offsetx_dim
\dim_set:Nn \l_flowframtkutils_annote_offsetx_dim { 1cm }
\dim_new:N \l_flowframtkutils_annote_offsety_dim
\dim_set:Nn \l_flowframtkutils_annote_offsety_dim { 1cm }
\int_new:N \l_flowframtkutils_annote_location_int
\int_new:N \l_flowframtkutils_current_annote_location_int
\int_const:Nn \c_flowframtkutils_annote_location_auto_int { 0 }
\int_const:Nn \c_flowframtkutils_annote_location_north_int { 1 }
\int_const:Nn \c_flowframtkutils_annote_location_northeast_int { 2 }
\int_const:Nn \c_flowframtkutils_annote_location_east_int { 3 }
\int_const:Nn \c_flowframtkutils_annote_location_southeast_int { 4 }
\int_const:Nn \c_flowframtkutils_annote_location_south_int { 5 }
\int_const:Nn \c_flowframtkutils_annote_location_southwest_int { 6 }
\int_const:Nn \c_flowframtkutils_annote_location_west_int { 7 }
\int_const:Nn \c_flowframtkutils_annote_location_northwest_int { 8 }
\cs_new:Nn \__flowframtkutils_annote_uncover:nn
 {
    \flowframtkutils_uncover:nn { #1 } { #2 }
 }
\cs_new:Nn \__flowframtkutils_get_annotation_text:Nnn
 {
   \tl_if_empty:nF { #2 }
    {
      \tl_set:Nn #1 { #2 }
    }
 }
\bool_new:N \l_flowframtkutils_default_auto_bool
\bool_set_false:N \l_flowframtkutils_default_auto_bool
\tl_new:N \l_flowframtkutils_default_overlay_tl
\cs_new:Nn \flowframtkutils_get_default_overlay:Nnn
 {
   \bool_if:NT \l_flowframtkutils_default_auto_bool
    {
      \tl_if_eq:nnF { #3 } { JDRGroup }
       {
         \tl_if_empty:NTF \l_flowframtkutils_default_overlay_tl
          {
            \int_gincr:N \g_flowframtkutils_overlay_int
          }
          {
            \int_gset:Nn \g_flowframtkutils_overlay_int
             { \l_flowframtkutils_default_overlay_tl }
          }
         \tl_set:NV
            #1
            \g_flowframtkutils_overlay_int
       }
    }
 }
\cs_new:Nn \flowframtkutils_get_default_annotation_overlay:Nnn
 {
   \tl_set:Nn #1 { 1 }
 }
\tl_new:N \l__flowframtkutils_annotation_tl
\keys_define:nn { flowframtkutils / overlay }
 {
    uncover .choice: ,
    uncover / single .code:n =
     {
       \cs_set:Nn \__flowframtkutils_uncover:nn
        {
          \flowframtkutils_uncover:nn { ##1 } { ##2 }
        }
     } ,
    uncover / from .code:n =
     {
       \cs_set:Nn \__flowframtkutils_uncover:nn
        {
          \flowframtkutils_uncover_from:nn { ##1 } { ##2 }
        }
     } ,
    uncover / false .code:n =
     {
       \cs_set:Nn \__flowframtkutils_uncover:nn { ##2 }
     } ,
    annote .choice: ,
    annote / match .code:n =
     {
       \cs_new:Nn \__flowframtkutils_annote_uncover:nn
        {
           \__flowframtkutils_uncover:nn { ##1 } { ##2 }
        }
       \bool_set_true:N \l_flowframtkutils_annote_bool
     } ,
    annote / single .code:n =
     {
       \cs_new:Nn \__flowframtkutils_annote_uncover:nn
        {
           \flowframtkutils_uncover:nn { ##1 } { ##2 }
        }
       \bool_set_true:N \l_flowframtkutils_annote_bool
     } ,
    annote / from .code:n =
     {
       \cs_new:Nn \__flowframtkutils_annote_uncover:nn
        {
           \flowframtkutils_uncover_from:nn { ##1 } { ##2 }
        }
       \bool_set_true:N \l_flowframtkutils_annote_bool
     } ,
    annote / true .code:n =
     {
       \bool_set_true:N \l_flowframtkutils_annote_bool
     } ,
    annote / false .code:n =
     {
       \bool_set_false:N \l_flowframtkutils_annote_bool
     } ,
    annote .default:n = true ,
    annote-position .choices:nn =
      {
         auto , north, northeast , east, southeast , south ,
         southwest, west , northwest
      }
      {
        \int_set:Nn
          \l_flowframtkutils_annote_location_int
           { \l_keys_choice_int - \c_one_int }
      } ,
    annote-arrow .code:n =
      {
        \keys_set:nn { flowframtkutils / overlay / arrow } { #1 }
      } ,
    annote-arrow .default:n = show ,
    annote-text .choice: ,
    annote-text / hide .code:n =
     {
       \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn { }
     } ,
    annote-text / description .code:n =
     {
       \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn
        {
          \tl_if_empty:nF { ##2 }
           {
             \tl_set:Nn ##1 { ##2 }
           }
        }
     } ,
    annote-text / tag .code:n =
     {
       \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn
        {
          \tl_if_empty:nF { ##3 }
           {
             \tl_set:Nn ##1 { ##3 }
           }
        }
     } ,
    annote-text / description-or-tag .code:n =
     {
       \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn
        {
          \tl_if_empty:nTF { ##2 }
           {
             \tl_if_empty:nF { ##3 }
              {
                \tl_set:Nn ##1 { ##3 }
              }
           }
           {
             \tl_set:Nn ##1 { ##2 }
           }
        }
     } ,
    annote-text / tag-map .code:n =
     {
       \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn
        {
          \tl_if_empty:nF { ##3 }
           {
             \prop_get:NnN \l_flowframtkutils_tag_text_prop
              { ##3 } ##1
           }
        }
     } ,
    tag-text .code:n =
     {
       \prop_set_from_keyval:Nn \l_flowframtkutils_tag_text_prop { #1 }
       \prop_if_empty:NF \l_flowframtkutils_tag_text_prop
        {
          \cs_set:Nn \__flowframtkutils_get_annotation_text:Nnn
           {
             \tl_if_empty:nF { ##3 }
              {
                \prop_get:NnN \l_flowframtkutils_tag_text_prop
                 { ##3 } ##1
              }
           }
        }
     } ,
    tag-overlay .code:n =
     {
       \prop_set_from_keyval:Nn \l_flowframtkutils_tag_overlay_prop { #1 }
       \prop_if_empty:NF \l_flowframtkutils_tag_overlay_prop
        {
          \bool_set_false:N \l__flowframtkutils_auto_overlay_bool
        }
     } ,
    object-overlay .code:n =
     {
       \prop_clear:N \l_flowframtkutils_object_type_overlay_prop
       \keys_set:nn { flowframtkutils / overlay / objects } { #1 }
       \prop_if_empty:NF \l_flowframtkutils_object_type_overlay_prop
        {
          \bool_set_false:N \l__flowframtkutils_auto_overlay_bool
        }
     } ,
    auto-overlay .bool_set:N = \l__flowframtkutils_auto_overlay_bool ,
    fallback-overlay .code:n =
     {
       \keys_set:nn { flowframtkutils / overlay / fallback } { #1 }
     } ,
    fallback-overlay .default:n = { enable } ,
 }
\keys_define:nn { flowframtkutils / overlay / fallback }
 {
    enable .bool_set:N = \l_flowframtkutils_default_auto_bool ,
    fixed .tl_set:N = \l_flowframtkutils_default_overlay_tl ,
    increment .code:n =
     {
       \tl_clear:N \l_flowframtkutils_default_overlay_tl
     } ,
    increment .value_forbidden:n = true ,
 }
\keys_define:nn { flowframtkutils / overlay / objects }
 {
    group .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRGroup } { #1 }
     },
    path .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRPath } { #1 }
     },
    text .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRText } { #1 }
     },
    text-path .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRTextPath } { #1 }
     },
    symmetric-path .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRSymmetricPath } { #1 }
     },
    bitmap .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRBitmap } { #1 }
     },
    scaled-pattern .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRScaledPattern } { #1 }
     },
    spiral-pattern .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRSpiralPattern } { #1 }
     },
    rotational-pattern .code:n =
     {
       \prop_put:Nne
         \l_flowframtkutils_object_type_overlay_prop
         { JDRRotationalPattern } { #1 }
     },
 }
\keys_define:nn { flowframtkutils / overlay / arrow }
 {
    show .bool_set:N = \l_flowframtkutils_annote_arrow_bool ,
    hide .bool_set_inverse:N = \l_flowframtkutils_annote_arrow_bool ,
    dx .dim_set:N = \l_flowframtkutils_annote_offsetx_dim ,
    dy .dim_set:N = \l_flowframtkutils_annote_offsety_dim ,
    color .code:n =
    {
      \tl_if_empty:nTF { #1 }
       {
         \tl_clear:N \l_flowframtkutils_annotation_stroke_color_tl
       }
       {
         \tl_set:Nn \l_flowframtkutils_annotation_stroke_color_tl
          { \pgfsetstrokecolor { #1 } }
       }
    } ,
    start .code:n =
    {
      \tl_if_empty:nTF { #1 }
       {
         \tl_clear:N \l_flowframtkutils_annotation_start_arrow_tl
       }
       {
         \tl_set:Nn \l_flowframtkutils_annotation_start_arrow_tl
          {
             \pgfsetarrowsstart { #1 }
          }
       }
    } ,
    end .code:n =
    {
      \tl_if_empty:nTF { #1 }
       {
         \tl_clear:N \l_flowframtkutils_annotation_end_arrow_tl
       }
       {
         \tl_set:Nn \l_flowframtkutils_annotation_end_arrow_tl
          {
             \pgfsetarrowsend { #1 }
          }
       }
    } ,
 }
\dim_new:N \l__flowframtkutils_image_minx_dim
\dim_new:N \l__flowframtkutils_image_miny_dim
\dim_new:N \l__flowframtkutils_image_maxx_dim
\dim_new:N \l__flowframtkutils_image_maxy_dim
\dim_new:N \l__flowframtkutils_image_cx_dim
\dim_new:N \l__flowframtkutils_image_cy_dim
\dim_new:N \l__flowframtkutils_image_width_dim
\dim_new:N \l__flowframtkutils_image_height_dim
\dim_new:N \l__flowframtkutils_object_minx_dim
\dim_new:N \l__flowframtkutils_object_miny_dim
\dim_new:N \l__flowframtkutils_object_maxx_dim
\dim_new:N \l__flowframtkutils_object_maxy_dim
\dim_new:N \l__flowframtkutils_object_cx_dim
\dim_new:N \l__flowframtkutils_object_cy_dim
\dim_new:N \l__flowframtkutils_object_width_dim
\dim_new:N \l__flowframtkutils_object_height_dim
\dim_new:N \l__flowframtkutils_x_dim
\dim_new:N \l__flowframtkutils_y_dim
\int_new:N \l_flowframtkutils_group_level_int
\cs_new:Nn \flowframtkutils_uncover_encap:nnnnnnnn
 {
    \cs_set_eq:NN \__flowframtkutils_current_encap:nn \use_ii:nn
    \int_if_zero:nTF { #1 }
     {
       \int_gzero:N \g_flowframtkutils_overlay_int
       \tl_clear:N \l__flowframtkutils_overlay_tl
       \int_zero:N \l_flowframtkutils_group_level_int
       \pgfextractx \l__flowframtkutils_image_minx_dim { #5 }
       \pgfextracty \l__flowframtkutils_image_miny_dim { #5 }
       \dim_set:Nn \l__flowframtkutils_image_width_dim { #6 }
       \dim_set:Nn \l__flowframtkutils_image_height_dim { #7 }
       \dim_set:Nn \l__flowframtkutils_image_maxx_dim
         {
            \l__flowframtkutils_image_minx_dim
          + \l__flowframtkutils_image_width_dim
         }
       \dim_set:Nn \l__flowframtkutils_image_maxy_dim
         {
            \l__flowframtkutils_image_miny_dim
          + \l__flowframtkutils_image_height_dim
         }
       \dim_set:Nn \l__flowframtkutils_image_cx_dim
         {
            \l__flowframtkutils_image_minx_dim
          + 0.5 \l__flowframtkutils_image_width_dim
         }
       \dim_set:Nn \l__flowframtkutils_image_cy_dim
         {
            \l__flowframtkutils_image_miny_dim
          + 0.5 \l__flowframtkutils_image_height_dim
         }
       \bool_if:NT \l_flowframtkutils_annote_bool
         {
           \dim_set_eq:NN
              \l__flowframtkutils_object_minx_dim
              \l__flowframtkutils_image_minx_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_miny_dim
              \l__flowframtkutils_image_miny_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_maxx_dim
              \l__flowframtkutils_image_maxx_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_maxy_dim
              \l__flowframtkutils_image_maxy_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_cx_dim
              \l__flowframtkutils_image_cx_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_cy_dim
              \l__flowframtkutils_image_cy_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_width_dim
              \l__flowframtkutils_image_width_dim
           \dim_set_eq:NN
              \l__flowframtkutils_object_height_dim
              \l__flowframtkutils_image_height_dim
         }
     }
     {
       \tl_set:Nn \l__flowframtkutils_propval_tl { \q_no_value }
       \bool_if:NTF \l__flowframtkutils_auto_overlay_bool
        {
          \tl_if_eq:nnF { #2 } { JDRGroup }
           {
             \int_gincr:N \g_flowframtkutils_overlay_int
             \tl_set:NV
                \l__flowframtkutils_propval_tl
                \g_flowframtkutils_overlay_int
           }
        }
        {
          \tl_if_empty:nF { #4 }
           {
             \prop_get:NnN \l_flowframtkutils_tag_overlay_prop { #4 }
               \l__flowframtkutils_propval_tl
           }
          \quark_if_no_value:NT
               \l__flowframtkutils_propval_tl
           {
             \prop_get:NnN \l_flowframtkutils_object_type_overlay_prop { #2 }
               \l__flowframtkutils_propval_tl
             \quark_if_no_value:NT
                  \l__flowframtkutils_propval_tl
              {
                \flowframtkutils_get_default_overlay:Nnn
                  \l__flowframtkutils_propval_tl
                  { #1 } { #2 }
              }
           }
        }
       \quark_if_no_value:NTF
            \l__flowframtkutils_propval_tl
        {
          \tl_clear:N \l__flowframtkutils_overlay_tl
        }
        {
           \tl_if_empty:NF \l__flowframtkutils_propval_tl
            {
              \cs_set_eq:NN
                \__flowframtkutils_current_encap:nn
                \__flowframtkutils_uncover:nn
            }
          \tl_set_eq:NN
            \l__flowframtkutils_overlay_tl
            \l__flowframtkutils_propval_tl
        }
       \bool_if:NT \l_flowframtkutils_annote_bool
        {
          \pgfextractx \l__flowframtkutils_object_minx_dim { #5 }
          \pgfextracty \l__flowframtkutils_object_miny_dim { #5 }
          \dim_set:Nn \l__flowframtkutils_object_width_dim { #6 }
          \dim_set:Nn \l__flowframtkutils_object_height_dim { #7 }
          \dim_set:Nn \l__flowframtkutils_object_maxx_dim
            {
               \l__flowframtkutils_object_minx_dim
              + \l__flowframtkutils_object_width_dim
            }
          \dim_set:Nn \l__flowframtkutils_object_maxy_dim
            {
               \l__flowframtkutils_object_miny_dim
              + \l__flowframtkutils_object_height_dim
            }
          \dim_set:Nn \l__flowframtkutils_object_cx_dim
            {
               \l__flowframtkutils_object_minx_dim
             + 0.5 \l__flowframtkutils_object_width_dim
            }
          \dim_set:Nn \l__flowframtkutils_object_cy_dim
            {
               \l__flowframtkutils_object_miny_dim
             + 0.5 \l__flowframtkutils_object_height_dim
            }
        }
     }
   \tl_if_eq:nnT { #2 } { JDRGroup }
     {
       \int_incr:N \l_flowframtkutils_group_level_int
     }
   \exp_args:NV
   \__flowframtkutils_current_encap:nn
     \l__flowframtkutils_overlay_tl { #8 }
   \bool_if:NT \l_flowframtkutils_annote_bool
    {
      \tl_clear:N \l__flowframtkutils_annotation_tl
      \tl_set:Nn \l__flowframtkutils_propval_tl { \q_no_value }
      \__flowframtkutils_get_annotation_text:Nnn
        \l__flowframtkutils_propval_tl
        { #3 } { #4 }
      \quark_if_no_value:NF
           \l__flowframtkutils_propval_tl
       {
          \int_if_zero:nTF
              { \l_flowframtkutils_annote_location_int }
            {
              \__flowframtkutils_auto_set_annote_location:
            }
            {
              \int_set_eq:NN
                 \l_flowframtkutils_current_annote_location_int
                 \l_flowframtkutils_annote_location_int
            }
          \exp_args:NV
          \__flowframtkutils_set_annote_content:n
            \l__flowframtkutils_propval_tl
       }
      \tl_if_empty:NF \l__flowframtkutils_annotation_tl
       {
         \tl_if_empty:NT \l__flowframtkutils_overlay_tl
          {
             \flowframtkutils_get_default_annotation_overlay:Nnn
              \l__flowframtkutils_overlay_tl { #1 } { #2 }
          }
         \exp_args:NVV
         \__flowframtkutils_annote_uncover:nn
            \l__flowframtkutils_overlay_tl
            \l__flowframtkutils_annotation_tl
       }
    }
   \tl_if_eq:nnT { #2 } { JDRGroup }
     {
       \int_decr:N \l_flowframtkutils_group_level_int
     }
 }
\cs_new:Nn \__flowframtkutils_auto_set_annote_location:
 {
   \dim_compare:nNnTF
      { \l__flowframtkutils_object_cx_dim }
       <
      { \l__flowframtkutils_image_cx_dim }
    {
      \int_set_eq:NN
        \l_flowframtkutils_current_annote_location_int
        \c_flowframtkutils_annote_location_west_int
      \dim_compare:nNnTF
         { \l__flowframtkutils_object_miny_dim }
          >
         { \l__flowframtkutils_image_cy_dim }
       {
         \int_set_eq:NN
           \l_flowframtkutils_current_annote_location_int
           \c_flowframtkutils_annote_location_northwest_int
       }
       {
         \dim_compare:nNnT
            { \l__flowframtkutils_object_maxy_dim }
             <
            { \l__flowframtkutils_image_cy_dim }
          {
            \int_set_eq:NN
              \l_flowframtkutils_current_annote_location_int
              \c_flowframtkutils_annote_location_southwest_int
          }
       }
    }
    {
      \int_set_eq:NN
        \l_flowframtkutils_current_annote_location_int
        \c_flowframtkutils_annote_location_east_int
      \dim_compare:nNnTF
         { \l__flowframtkutils_object_miny_dim }
          >
         { \l__flowframtkutils_image_cy_dim }
       {
         \int_set_eq:NN
           \l_flowframtkutils_current_annote_location_int
           \c_flowframtkutils_annote_location_northeast_int
       }
       {
         \dim_compare:nNnT
            { \l__flowframtkutils_object_maxy_dim }
             <
            { \l__flowframtkutils_image_cy_dim }
          {
            \int_set_eq:NN
              \l_flowframtkutils_current_annote_location_int
              \c_flowframtkutils_annote_location_southeast_int
          }
       }
    }
 }
\tl_new:N \l_flowframtkutils_annotation_stroke_color_tl
\tl_set:Nn \l_flowframtkutils_annotation_stroke_color_tl
 {
    \pgfsetstrokecolor { black }
 }
\tl_new:N \l_flowframtkutils_annotation_start_arrow_tl
\tl_set:Nn \l_flowframtkutils_annotation_start_arrow_tl
 {
    \pgfsetarrowsstart { < }
 }
\tl_new:N \l_flowframtkutils_annotation_end_arrow_tl
\cs_new:Nn \__flowframtkutils_set_annote_content:n
 {
    \tl_set:Nn \l__flowframtkutils_annotation_tl
     {
        \begin { pgfscope }
        \l_flowframtkutils_annotation_stroke_color_tl
        \l_flowframtkutils_annotation_start_arrow_tl
        \l_flowframtkutils_annotation_end_arrow_tl
     }
    \int_case:nn { \l_flowframtkutils_current_annote_location_int }
     {
       { \c_flowframtkutils_annote_location_north_int }
        {
          \dim_set_eq:NN
             \l__flowframtkutils_x_dim
             \l__flowframtkutils_object_cx_dim
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
              \l__flowframtkutils_object_maxy_dim
                + \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_cx_dim }
                       { \dim_use:N \l__flowframtkutils_object_maxy_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               bottom ,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_northeast_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
              \l__flowframtkutils_object_maxx_dim
                + \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
              \l__flowframtkutils_object_maxy_dim
                + \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_maxx_dim }
                       { \dim_use:N \l__flowframtkutils_object_maxy_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               left , bottom ,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_east_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
              \l__flowframtkutils_object_maxx_dim
                + \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set_eq:NN
            \l__flowframtkutils_y_dim
            \l__flowframtkutils_object_cy_dim
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_maxx_dim }
                       { \dim_use:N \l__flowframtkutils_object_cy_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               left ,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_southeast_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
              \l__flowframtkutils_object_maxx_dim
                + \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
              \l__flowframtkutils_object_miny_dim
                - \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_maxx_dim }
                       { \dim_use:N \l__flowframtkutils_object_miny_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               top, left ,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_south_int }
        {
          \dim_set_eq:NN
             \l__flowframtkutils_x_dim
             \l__flowframtkutils_object_cx_dim
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
              \l__flowframtkutils_object_miny_dim
                - \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_cx_dim }
                       { \dim_use:N \l__flowframtkutils_object_miny_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               top,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_southwest_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
             \l__flowframtkutils_object_minx_dim
              - \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
              \l__flowframtkutils_object_miny_dim
                - \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_minx_dim }
                       { \dim_use:N \l__flowframtkutils_object_miny_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               top , right,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_west_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
              \l__flowframtkutils_object_minx_dim
              - \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set_eq:NN
            \l__flowframtkutils_y_dim
            \l__flowframtkutils_object_cy_dim
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_minx_dim }
                       { \dim_use:N \l__flowframtkutils_object_cy_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               right,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
       { \c_flowframtkutils_annote_location_northwest_int }
        {
          \dim_set:Nn \l__flowframtkutils_x_dim
           {
             \l__flowframtkutils_object_minx_dim
              - \l_flowframtkutils_annote_offsetx_dim
           }
          \dim_set:Nn \l__flowframtkutils_y_dim
           {
             \l__flowframtkutils_object_maxy_dim
               + \l_flowframtkutils_annote_offsety_dim
           }
          \bool_if:NT \l_flowframtkutils_annote_arrow_bool
           {
             \tl_put_right:Ne \l__flowframtkutils_annotation_tl
              {
                 \exp_not:N \pgfpathmoveto
                   {
                     \exp_not:N \pgfpoint
                       { \dim_use:N \l__flowframtkutils_object_minx_dim }
                       { \dim_use:N \l__flowframtkutils_object_maxy_dim }
                   }
                 \exp_not:N \pgfpathlineto
                   {
                     \exp_not:N \pgfpoint
                       {
                         \dim_use:N \l__flowframtkutils_x_dim
                       }
                       {
                         \dim_use:N \l__flowframtkutils_y_dim
                       }
                   }
                  \exp_not:N \pgfusepath { stroke }
              }
           }
          \tl_put_right:Ne \l__flowframtkutils_annotation_tl
           {
             \exp_not:N \pgftext
              [
               bottom, right,
               at = {
                \exp_not:N \pgfpoint
                  {
                    \dim_use:N \l__flowframtkutils_x_dim
                  }
                  {
                    \dim_use:N \l__flowframtkutils_y_dim
                  }
              } ]
              { #1 }
           }
        }
     }
    \tl_put_right:Nn \l__flowframtkutils_annotation_tl
     {
        \end { pgfscope }
     }
 }
\NewDocumentCommand \FlowFramTkUtilsSetOverlayEncap { o }
 {
   \IfValueT { #1 }
    {
      \keys_set:nn { flowframtkutils / overlay } { #1 }
    }
   \renewcommand \flowframtkencapobject
    {
      \flowframtkutils_uncover_encap:nnnnnnnn
    }
 }
\NewDocumentCommand \FlowFramTkUtilsOverlayEncapSetup { m }
 {
   \keys_set:nn { flowframtkutils / overlay } { #1 }
 }
\ProvideDocumentCommand \includeteximage { o m }
 {
   \group_begin:
    \let\input@path\Ginput@path
    \IfValueTF { #1 }
     {
       \hbox_set:Nn \l__flowframtk_img_box
        { \file_input:n { #2 } }
       \keys_set:nn { flowframtk / img } { #1 }
       \__flowframtk_img_apply_resize:
       \mbox { \box_use:N \l__flowframtk_img_box }
     }
     {
       \file_input:n { #2 }
     }
   \group_end:
 }
\box_new:N \l__flowframtk_img_box
\tl_new:N \l__flowframtk_img_width_tl
\tl_new:N \l__flowframtk_img_height_tl
\cs_new:Nn \__flowframtk_img_apply_resize:
{
  \tl_if_empty:NTF \l__flowframtk_img_width_tl
  {
    \tl_if_empty:NF \l__flowframtk_img_height_tl
     {
       \box_resize_to_ht:Nn
        \l__flowframtk_img_box { \l__flowframtk_img_height_tl }
     }
    \tl_clear:N \l__flowframtk_img_height_tl
  }
  {
    \tl_if_empty:NTF \l__flowframtk_img_height_tl
     {
       \box_resize_to_wd:Nn
        \l__flowframtk_img_box { \l__flowframtk_img_width_tl }
     }
     {
       \box_resize_to_wd_and_ht:Nnn
        \l__flowframtk_img_box
         { \l__flowframtk_img_width_tl }
         { \l__flowframtk_img_height_tl }
       \tl_clear:N \l__flowframtk_img_height_tl
     }
    \tl_clear:N \l__flowframtk_img_width_tl
  }
}
\keys_define:nn { flowframtk / img }
 {
    scale .code:n =
     {
       \__flowframtk_img_apply_resize:
       \box_scale:Nnn  \l__flowframtk_img_box { #1 } { #1 }
     },
    angle .code:n =
     {
       \__flowframtk_img_apply_resize:
       \box_rotate:Nn  \l__flowframtk_img_box { #1 }
     },
    width .tl_set:N = \l__flowframtk_img_width_tl ,
    height .tl_set:N = \l__flowframtk_img_height_tl ,
    alt .code:n = { }
 }
\newcommand \flowframtkimgtitlechar [ 2 ] { #1 }
\cs_new:Nn \__flowframtk_imgtitlechar:nn
 {
   \tl_to_str:n { #2 }
 }
\cs_if_exist:NTF \pdfinfo
 {
   \cs_new:Nn \__flowframtk_pdfinfo:n
    {
      \pdfinfo { #1 }
    }
 }
 {
   \cs_if_exist:NTF \pdfextension
    {
      \cs_new:Nn \__flowframtk_pdfinfo:n
       {
         \pdfextension info { #1 }
       }
    }
    {
      \cs_new:Nn \__flowframtk_pdfinfo:n { }
    }
 }
\tl_new:N \l_flowframtk_image_title_tl
\ProvideDocumentCommand \flowframtkSetTitle { m }
 {
   \tl_set:Ne \l_flowframtk_image_title_tl { #1 }
   \cs_if_exist:NTF \hypersetup
    {
      \hypersetup { pdftitle = { \l_flowframtk_image_title_tl } }
    }
    {
      \cs_set_eq:NN \flowframtkimgtitlechar \__flowframtk_imgtitlechar:nn
      \__flowframtk_pdfinfo:n { /Title ( #1 ) }
      \cs_set_eq:NN \flowframtkimgtitlechar \use_i:nn
    }
   \cs_if_exist:NT \title
    {
      \exp_args:NV \title \l_flowframtk_image_title_tl
    }
 }
\tl_new:N \l_flowframtk_image_creationdate_tl
\ProvideDocumentCommand \flowframtkSetCreationDate { m }
 {
   \tl_set:Ne \l_flowframtk_image_creationdate_tl
     {
       \tl_to_str:n { #1 }
     }
   \cs_if_exist:NTF \hypersetup
    {
      \exp_args:Ne
        \hypersetup
        { pdfcreationdate = { \l_flowframtk_image_creationdate_tl } }
    }
    {
      \exp_args:Ne
        \__flowframtk_pdfinfo:n
          { /CreationDate (  \l_flowframtk_image_creationdate_tl ) }
    }
 }
\keys_define:nn { flowframtk / imageinfo }
{
   title .code:n = \flowframtkSetTitle { #1 } ,
   creationdate .code:n = \flowframtkSetCreationDate { #1 } ,
}
\NewDocumentCommand \flowframtkimageinfo { m }
 {
   \keys_set:nn { flowframtk / imageinfo } { #1 }
 }
\NewDocumentCommand \flowframtkNewFrameBorder { m m }
 {
   \cs_set:cpn { @flf@border@ #1 } ##1 { #2 }
 }
\newcommand \flowframtkUseFrameBorderCsName [ 1 ]
 {
   @flf@border@ #1
 }
\newcommand \flowframtkUseFrameBorderCs [ 1 ]
 {
   \use:n { @flf@border@ #1 }
 }
\NewDocumentCommand \flowframtkNewDynamicStyle { m m }
 {
   \cs_set:cpn { @flf@dfstyle@ #1 } { #2 }
 }
\NewDocumentCommand \flowframtkUseDynamicStyleCsName { m  }
 {
   @flf@dfstyle@ #1
 }
\NewDocumentCommand \flowframtkUseDynamicStyle { m  }
 {
   \use:n { @flf@dfstyle@ #1 }
 }
\NewDocumentCommand \flowframtkSetDynamicOddHead { m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_header_int \l__flowfram_id_int
   \renewcommand \@dothehead { }
   \renewcommand \@dodynamicthehead
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_header_int }
       {
         \flowfram_dynamic_header:n
           { \g__flowfram_dynamic_header_int }
       }
    }
 }
\NewDocumentCommand \flowframtkSetDynamicOddEvenHead { m m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_header_int \l__flowfram_id_int
   \__flowfram_get_dynamic_id:n { #2 }
   \int_set_eq:NN \g__flowfram_dynamic_even_header_int \l__flowfram_id_int
   \renewcommand \@dothehead { }
   \renewcommand \@dodynamicthehead
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_header_int }
       {
         \flowfram_dynamic_odd_header:n
           { \g__flowfram_dynamic_header_int }
       }
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_even_header_int }
       {
         \flowfram_dynamic_even_header:n
           { \g__flowfram_dynamic_even_header_int }
       }
    }
   \@twosidetrue
 }
\NewDocumentCommand \flowframtkSetDynamicEvenHead { m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_even_header_int \l__flowfram_id_int
   \renewcommand \@dothehead { }
   \cs_set:Ne \@dodynamicthehead
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_even_header_int }
       {
         \flowfram_dynamic_even_header:n
           { \g__flowfram_dynamic_even_header_int }
       }
    }
   \@twosidetrue
 }
\NewDocumentCommand \flowframtkSetDynamicOddFoot { m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_footer_int \l__flowfram_id_int
   \renewcommand \@dothefoot { }
   \renewcommand \@dodynamicthefoot
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_footer_int }
       {
          \flowfram_dynamic_footer:n
           { \g__flowfram_dynamic_footer_int }
       }
    }
 }
\NewDocumentCommand \flowframtkSetDynamicOddEvenFoot { m m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_footer_int \l__flowfram_id_int
   \__flowfram_get_dynamic_id:n { #2 }
   \int_set_eq:NN \g__flowfram_dynamic_even_footer_int \l__flowfram_id_int
   \renewcommand \@dothefoot { }
   \renewcommand \@dodynamicthefoot
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_footer_int }
       {
          \flowfram_dynamic_odd_footer:n
           { \g__flowfram_dynamic_footer_int }
       }
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_even_footer_int }
       {
          \flowfram_dynamic_even_footer:n
           { \g__flowfram_dynamic_even_footer_int }
       }
    }
   \@twosidetrue
 }
\NewDocumentCommand \flowframtkSetDynamicEvenFoot { m }
 {
   \__flowfram_get_dynamic_id:n { #1 }
   \int_set_eq:NN \g__flowfram_dynamic_even_footer_int \l__flowfram_id_int
   \renewcommand \@dothefoot { }
   \renewcommand \@dodynamicthefoot
    {
     \__flowfram_set_dynamic_contents:nn
       { \g__flowfram_dynamic_even_footer_int }
       {
          \flowfram_dynamic_even_footer:n
           { \g__flowfram_dynamic_even_footer_int }
       }
    }
   \@twosidetrue
 }
\NewDocumentCommand \flowframtkMakeDFHeaderFooter { }
 {
  \tl_clear:N \g__flowfram_headercolor_tl
  \tl_clear:N \g__flowfram_footercolor_tl
  \__flowfram_adjust_page_styles:n
   {
      \let \ps@myheadings \ps@ffmyheadings
      \let \ps@headings \ps@ffheadings
      \let \ps@plain \ps@ffplain
      \let \ps@empty \ps@ffempty
   }
  \pagestyle { ffheadings }
  \cs_set:Nn \__flowfram_only_pre_makedfheaderfooter:nn
   {
     \msg_error:nnn { flowfram } { option-too-late } { ##1 }
       { \flowframtkMakeDFHeaderFooter }
   }
 }
\ExplSyntaxOff
\endinput
%%
%% End of file `flowframtkutils.sty'.
